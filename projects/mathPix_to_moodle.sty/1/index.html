<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="k_58m2Lddpj9zu2A5OZaMbeMZtgPh7jYnIRxsBdFBwM"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> mathPix to moodle.sty | Omar M. Elshenawy </title> <meta name="author" content="Omar M. Elshenawy"> <meta name="description" content="a RegEx project to speed up digital transformation to moodle"> <meta name="keywords" content="junior mathematicianmathematicsmathematics educationmathematical researchtopological graph theoryalgebraic number theorydata analyticsfinanceITproject managementteachingundegraduatenumerical methodsconstructor universityomar elshenawyomar elshinawy"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%CE%BE)&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://elshenawyom.github.io/projects/mathPix_to_moodle.sty/1/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Omar M. Elshenawy </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">curriculum vitae </a> </li> <li class="nav-item "> <a class="nav-link" href="/seminars-talks/">seminars &amp; talks </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">mathPix to moodle.sty</h1> <p class="post-description">a RegEx project to speed up digital transformation to moodle</p> </header> <article> <p><strong>Table of Contents</strong></p> <ol type="i"> <li><a href="#mwe">a minimal working example</a></li> <li> <a href="#pr">processing</a> <ol type="i"> <li><a href="#no">no rationale</a></li> </ol> </li> <li> <a href="#da">data extraction</a> <ol type="i"> <li><a href="#co">correct answer</a></li> <li><a href="#id">question id</a></li> <li><a href="#bo">question body</a></li> <li><a href="#sm">shortanswer or multi?</a></li> </ol> </li> <li> <a href="#pa">parsing</a> <ol type="i"> <li> <a href="#te">question templates</a> <ol type="i"> <li><a href="#sh">shortanswer</a></li> <li><a href="#mu">multi</a></li> </ol> </li> <li> <a href="#al">altogether</a> <ol type="i"> <li><a href="#ou">output</a></li> <li><a href="#br">a brief note</a></li> </ol> </li> </ol> </li> </ol> <hr> <h2 id="mwe"> <code class="language-plaintext highlighter-rouge">i.</code> a minimal working example</h2> <p>Here, we have an SAT mathematics exercise.</p> <div style="text-align: center;"> <img src="/assets/img/mathPIX-to-moodle.sty/09d21d79-collegeboard.png" class="img-fluid rounded z-depth-1" style="width: 60%; height: auto;"> </div> <div style="margin-top: 15px;"></div> <p>With 200+ students in my class, it is very difficult to give personalized feedback. Therefore, we would like to have this exercise in nice digital format.</p> <div style="margin-top: 15px;"></div> <div style="text-align: center;"> <img src="/assets/img/mathPIX-to-moodle.sty/09d21d79.png" class="img-fluid rounded z-depth-1" style="width: 60%; height: auto;"> </div> <div style="margin-top: 15px;"></div> <p>This may of course be done using <code class="language-plaintext highlighter-rouge">moodle.sty</code>, and lots of copy-pasting if youâ€™d like. It can, however, become impractical to repeat that for 1000+ questions. We propose the following question: is there a better way?</p> <p>Yes is the answer to the previous question. Instead of mindlessly copy-pasting questions, we decided to invest time and effort into a tool that does most of the work for us.</p> <ul> <li> <a href="https://moodle.com/" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">moodle</code></a> is an open-source LMS software utilised by many institutions worldwide, including mine.</li> <li> <a href="https://mathpix.com/" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">mathPIX</code></a> is an OCR software that specializes in rendering \(\LaTeX\).</li> <li> <a href="https://osl.ugr.es/CTAN/macros/latex/contrib/moodle/moodle.pdf" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">moodle.sty</code></a> is a \(\LaTeX\) package that mass-imports questions with <code class="language-plaintext highlighter-rouge">math</code> content into <code class="language-plaintext highlighter-rouge">moodle</code>.</li> </ul> <p>The goal of this project is to start with <code class="language-plaintext highlighter-rouge">pdf</code> documents rendered into text using <code class="language-plaintext highlighter-rouge">mathPIX</code>, and then utilise <code class="language-plaintext highlighter-rouge">regEx</code> to bring it to a <code class="language-plaintext highlighter-rouge">moodle.sty</code>-compatible format for import into <code class="language-plaintext highlighter-rouge">moodle</code>.</p> <p>This notebook <code class="language-plaintext highlighter-rouge">mathPix-to-moodle.sty</code> aims to achieve our stated goal for one question. Then, the notebook <code class="language-plaintext highlighter-rouge">massPix-to-moodle.sty</code> generalises the construction for masses of questions. If you would like to immediately jump to there, please use</p> <h4 id="-masspix-to-moodlesty"><a href="/projects/mathPix-to-moodle.sty/2/">&gt; massPix-to-moodle.sty</a></h4> <div style="margin-top: 15px;"></div> <p>Let us now examine the <code class="language-plaintext highlighter-rouge">mathPIX</code> text input.</p> <h2 id="pr"> <code class="language-plaintext highlighter-rouge">ii.</code> processing</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span>
</code></pre></div></div> <p>We start by reading extracted text from our file.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read_text_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">content</span>
</code></pre></div></div> <p>I have included three minimal working examples in the <code class="language-plaintext highlighter-rouge">mwe</code> directory.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">q-multi.txt</code> is a multiple-choice question;</li> <li> <code class="language-plaintext highlighter-rouge">q-shortanswer.txt</code> is a short-answer question;</li> <li> <code class="language-plaintext highlighter-rouge">q-shortanswer-media.txt</code> is a short-answer question with media.</li> </ul> <p>The input is not too nice, but we may start working with it for now. Below you will see the formatted output of the very-same question we saw above.</p> <p><strong>N.B:</strong> this was done using mathPIX, the \(\LaTeX\) OCR software.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">txt</span> <span class="o">=</span> <span class="nf">read_text_file</span><span class="p">(</span><span class="sh">"</span><span class="s">mwe/q-shortanswer-media.txt</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\section*{Question Difficulty: Hard}

\section*{Question ID 09d21d79}
\begin{tabular}{|l|l|l|l|l|}
\hline Assessment &amp; Test &amp; Domain &amp; Skill \\
SAT &amp; Math &amp; Advanced Math &amp; Nonlinear functions &amp; Difficulty \\
$\square \square$ \\
\hline
\end{tabular}

\section*{ID: 09d21d79}
![](https://cdn.mathpix.com/cropped/2024_11_04_a374deafc4bc3bc8f639g-10.jpg?height=858&amp;width=861&amp;top_left_y=679&amp;top_left_x=129)

The graph of $y=2 x^{2}+b x+c$ is shown, where $b$ and $c$ are constants. What is the value of $b c$ ?

\section*{ID: 09d21d79 Answer}

Correct Answer: -24

\section*{Rationale}

The correct answer is -24 . Since the graph passes through the point $0,-6$, it follows that when the value of $x$ is 0 , the value of $y$ is -6 . Substituting 0 for $x$ and -6 for $y$ in the given equation yields $-6=20^{2}+b 0+c$, or $-6=c$. Therefore, the value of $c$ is -6 . Substituting -6 for $c$ in the given equation yields $y=2 x^{2}+b x-6$. Since the graph passes through the point $-1,-8$, it follows that when the value of $x$ is -1 , the value of $y$ is -8 . Substituting -1 for $x$ and -8 for $y$ in the equation $y=2 x^{2}+b x-6$ yields $-8=2-1^{2}+b-1-6$, or $-8=2-b-6$, which is equivalent to $-8=-4-b$. Adding 4 to each side of this equation yields $-4=-b$. Dividing each side of this equation by -1 yields $4=b$. Since the value of $b$ is 4 and the value of $c$ is -6 , it follows that the value of $b c$ is $4-6$, or -24 .

Alternate approach: The given equation represents a parabola in the $x y$-plane with a vertex at $-1,-8$. Therefore, the given equation, $y=2 x^{2}+b x+c$, which is written in standard form, can be written in vertex form, $y=a x-h^{2}+k$, where $h, k$ is the vertex of the parabola and $a$ is the value of the coefficient on the $x^{2}$ term when the equation is written in standard form. It follows that $a=2$. Substituting 2 for $a,-1$ for $h$, and -8 for $k$ in this equation yields $y=2 x--1^{2}+-8$, or $y=2 x+1^{2}$ - 8 . Squaring the binomial on the right-hand side of this equation yields $y=2 x^{2}+2 x+1-8$. Multiplying each term inside the parentheses on the right-hand side of this equation by 2 yields $y=2 x^{2}+4 x+2-8$, which is equivalent to $y=2 x^{2}+4 x-6$. From the given equation $y=2 x^{2}+b x+c$, it follows that the value of $b$ is 4 and the value of $c$ is -6 .
Therefore, the value of $b c$ is $4-6$, or -24 .

Question Difficulty: Hard
</code></pre></div></div> <h3 id="no"> <code class="language-plaintext highlighter-rouge">ii.i</code> no rationale</h3> <p>We remove rationale for the sake of simplicity. In a practical sense, students may still retain the <em>rationale</em> section of a question by looking up the question <code class="language-plaintext highlighter-rouge">id</code>, which in this case is <a href="https://www.google.com/search?sca_esv=581abf87ebc1492d&amp;q=09d21d79+sat&amp;source=lnms&amp;fbs=AEQNm0Aa4sjWe7Rqy32pFwRj0UkWd8nbOJfsBGGB5IQQO6L3JyJJclJuzBPl12qJyPx7ESI3cvVcqCdLSFFSD0xy83MxBKgRWp-QNbGOEJPj7KkhLDY4xUCEL9vvEWQyl1UyPMFfBseoDVPegO8KfpTS52Eo5kLtbJpPSyqCy0MiaV6PnhwS9ZmVR0jKN8yGaHpfZ-ZSkEcR&amp;sa=X&amp;ved=2ahUKEwiTm5_D5oWLAxXonf0HHZhODFIQ0pQJegQIGhAB&amp;biw=1536&amp;bih=730&amp;dpr=1.25" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">09d21d79</code></a>. One may additionally refer to <a href="https://satsuitequestionbank.collegeboard.org/digital/search" rel="external nofollow noopener" target="_blank">CollegeBoard</a>, choose the respective topic and difficulty, then look up the code using <code class="language-plaintext highlighter-rouge">ctrl + f</code>.</p> <p>It is merely a matter of taste. To proceed, notice that <em>rationale</em> is marked by starting with <code class="language-plaintext highlighter-rouge">\section*{Rationale}</code> and proceeding until the start of the following question.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">remove_rationale</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># This pattern looks for '\section*{Rationale}' and removes everything until the next '\section*{' or end of string
</span>    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\\section\*\{Rationale\}.*?(?=\\section\*|\Z)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">txt</span> <span class="o">=</span> <span class="nf">remove_rationale</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\section*{Question Difficulty: Hard}

\section*{Question ID 09d21d79}
\begin{tabular}{|l|l|l|l|l|}
\hline Assessment &amp; Test &amp; Domain &amp; Skill \\
SAT &amp; Math &amp; Advanced Math &amp; Nonlinear functions &amp; Difficulty \\
$\square \square$ \\
\hline
\end{tabular}

\section*{ID: 09d21d79}
![](https://cdn.mathpix.com/cropped/2024_11_04_a374deafc4bc3bc8f639g-10.jpg?height=858&amp;width=861&amp;top_left_y=679&amp;top_left_x=129)

The graph of $y=2 x^{2}+b x+c$ is shown, where $b$ and $c$ are constants. What is the value of $b c$ ?

\section*{ID: 09d21d79 Answer}

Correct Answer: -24
</code></pre></div></div> <h2 id="da"> <code class="language-plaintext highlighter-rouge">iii.</code> data extraction</h2> <p>We outline the extraction process of four key elements: <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;type&gt;</code>.</p> <h3 id="co"> <code class="language-plaintext highlighter-rouge">iii.i</code> correct answer</h3> <p>Next, let us fetch the correct answer <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code>. This is always found within the string <code class="language-plaintext highlighter-rouge">Correct Answer: &lt;ans&gt;</code>. This is an easy observation once you inspect the <code class="language-plaintext highlighter-rouge">pdf</code> documents containing the exercises.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_correct_answer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Find the correct answer, allowing for negative signs in the answer
</span>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">Correct Answer:\s*(-?\d+)</span><span class="sh">'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="bp">None</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ans</span> <span class="o">=</span> <span class="nf">fetch_correct_answer</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-24
</code></pre></div></div> <h3 id="id"> <code class="language-plaintext highlighter-rouge">iii.ii</code> question id</h3> <p>To fetch <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code>, we look up the string <code class="language-plaintext highlighter-rouge">\section*{Question ID &lt;id&gt;}</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_question_id</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Find the question ID
</span>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\\section\*\{\s*Question ID\s+(\w+)\s*\}</span><span class="sh">'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="bp">None</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q_id</span> <span class="o">=</span> <span class="nf">fetch_question_id</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q_id</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>09d21d79
</code></pre></div></div> <h3 id="id"> <code class="language-plaintext highlighter-rouge">iii.iii</code> question body</h3> <p>The question body is always in the form</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\section*{ID: &lt;id&gt;}

&lt;body&gt;
&lt;choices&gt; %if any

\section*{ID: &lt;id&gt; Answer}

</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">fetch_question_body</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="c1"># Pattern to capture everything between \section*{ID: &lt;question-id&gt;} and the start of choices (A., B., C., or D.)
</span>    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="sh">'</span><span class="s">\\section\*\{</span><span class="si">{</span><span class="n">ID</span><span class="si">:</span> <span class="si">{</span><span class="n">question_id</span><span class="si">}</span>\<span class="si">}</span><span class="s">}\s*(.*?)(?=\s*[A-D]\.\s|\s*\\section\*\{</span><span class="si">{</span><span class="n">ID</span><span class="si">:</span> <span class="si">{</span><span class="n">question_id</span><span class="si">}</span> <span class="n">Answer</span>\<span class="si">}</span><span class="s">})</span><span class="sh">'</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q_body</span> <span class="o">=</span> <span class="nf">fetch_question_body</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">q_id</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q_body</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ID: 09d21d79
</code></pre></div></div> <h3 id="sm"> <code class="language-plaintext highlighter-rouge">iii.iv</code> <code class="language-plaintext highlighter-rouge">shortanswer</code> or <code class="language-plaintext highlighter-rouge">multi</code>?</h3> <p>To determine question type, we inspect <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code>.</p> <ul> <li> <p>If <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code> is a literal <code class="language-plaintext highlighter-rouge">A - D</code>, then clearly this is a <code class="language-plaintext highlighter-rouge">multi</code> question.</p> </li> <li> <p>Otherwise, there is a numerical or fractional answer of the form <code class="language-plaintext highlighter-rouge">a.bc</code> or <code class="language-plaintext highlighter-rouge">d/e</code> which characterizes a <code class="language-plaintext highlighter-rouge">shortanswer</code> question.</p> </li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">determine_question_type</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="c1"># Determine if the question is a short answer or multiple-choice based on the answer format
</span>    <span class="k">if</span> <span class="n">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">^-?\d+$|^-?\d+/\d+$</span><span class="sh">'</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>  <span class="c1"># Checks if answer is a number (including negative) or fraction
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">shortanswer</span><span class="sh">"</span>
    <span class="k">elif</span> <span class="n">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">^[A-D]$</span><span class="sh">'</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>  <span class="c1"># Checks if answer is A, B, C, or D
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">multi</span><span class="sh">"</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q_type</span> <span class="o">=</span> <span class="nf">determine_question_type</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q_type</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shortanswer
</code></pre></div></div> <h2 id="pa"> <code class="language-plaintext highlighter-rouge">iv.</code> parsing</h2> <p>Upon constructing the necessary <code class="language-plaintext highlighter-rouge">multi</code> and <code class="language-plaintext highlighter-rouge">shortanswer</code> templates, we combine our elements in a <code class="language-plaintext highlighter-rouge">parse_question</code> function to give the intended result.</p> <h3 id="te"> <code class="language-plaintext highlighter-rouge">iv.i</code> question templates</h3> <h4 id="sh"> <code class="language-plaintext highlighter-rouge">iv.i.i</code> - <code class="language-plaintext highlighter-rouge">shortanswer</code> </h4> <p>The <code class="language-plaintext highlighter-rouge">shortanswer</code> moodle template is given as follows,</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\begin{shortanswer}[fraction=100]{&lt;id&gt;}
&lt;body&gt;
\item[fraction=100] &lt;ans&gt;
\end{shortanswer}
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">format_shortanswer</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
    <span class="c1"># Format short answer question
</span>    <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="se">\\</span><span class="s">begin[fraction=100]}
</span><span class="si">{</span><span class="n">question_body</span><span class="si">}</span><span class="s">
</span><span class="se">\\</span><span class="s">item[fraction=100] </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s">
</span><span class="se">\\</span><span class="s">end</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">formatted</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#q = format_shortanswer(q_id, q_body, ans)
#print(q)
</span></code></pre></div></div> <p>This finishes the job for <code class="language-plaintext highlighter-rouge">shortanswer</code>-type questions. Now remains to handle the <code class="language-plaintext highlighter-rouge">multi</code> case, specifically with choices.</p> <h4 id="mu"> <code class="language-plaintext highlighter-rouge">iv.i.ii</code> - <code class="language-plaintext highlighter-rouge">multi</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">extract_choices</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Extract choices while handling multiline content after each label (A., B., C., D.)
</span>    <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">([A-D]\.\s.*?)(?=\s*[A-D]\.|\\section\*\{ID:|$)</span><span class="sh">'</span>  <span class="c1"># Match choices A., B., C., D.
</span>    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="c1"># Normalize line breaks and strip leading/trailing whitespace
</span>        <span class="n">choices</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">match</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">).</span><span class="nf">strip</span><span class="p">())</span>
        
    <span class="c1"># Remove the choice labels (A., B., C., D.) from each extracted choice
</span>    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">choice</span><span class="p">[</span><span class="mi">2</span><span class="p">:].</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>  <span class="c1"># Removes label (e.g., "A. " to keep just the choice)
</span>    
    <span class="k">return</span> <span class="n">choices</span> <span class="k">if</span> <span class="n">choices</span> <span class="k">else</span> <span class="bp">None</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q_choices</span> <span class="o">=</span> <span class="nf">extract_choices</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q_choices</span><span class="p">)</span> <span class="c1">## returns none, as the question is short-answer.
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>None
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">format_multi</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
    <span class="c1"># Map answer to corresponding choice and format multiple-choice question
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">answer_index</span> <span class="o">=</span> <span class="nf">ord</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="o">-</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">item * </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="sh">"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">answer_index</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">item </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">choices</span><span class="p">)]</span>
        <span class="n">formatted_items</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="se">\\</span><span class="s">begin}
    </span><span class="si">{</span><span class="n">question_body</span><span class="si">}</span><span class="s">

    </span><span class="si">{</span><span class="n">formatted_items</span><span class="si">}</span><span class="s">
    </span><span class="se">\\</span><span class="s">end</span><span class="sh">"""</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="sh">"</span><span class="s">None</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">formatted</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q</span> <span class="o">=</span> <span class="nf">format_multi</span><span class="p">(</span><span class="n">q_id</span><span class="p">,</span> <span class="n">q_body</span><span class="p">,</span> <span class="n">ans</span><span class="p">,</span> <span class="n">q_choices</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="c1">## returns none, as the question is short-answer.
</span></code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>None
</code></pre></div></div> <h3 id="al"> <code class="language-plaintext highlighter-rouge">iv.ii</code> altogether</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Main function to orchestrate parsing and formatting
</span><span class="k">def</span> <span class="nf">parse_question</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nf">remove_rationale</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    
    <span class="n">question_id</span> <span class="o">=</span> <span class="nf">fetch_question_id</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="nf">fetch_correct_answer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">question_body</span> <span class="o">=</span> <span class="nf">fetch_question_body</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">question_id</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">all</span><span class="p">([</span><span class="n">question_id</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">question_body</span><span class="p">]):</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unable to parse question properly.</span><span class="sh">"</span>

    <span class="n">question_type</span> <span class="o">=</span> <span class="nf">determine_question_type</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">question_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">shortanswer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">format_shortanswer</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">question_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">multi</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nf">extract_choices</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">choices</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">format_multi</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">choices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Multiple-choice question lacks choices or has an incorrect format.</span><span class="sh">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unknown question type or unrecognized answer format.</span><span class="sh">"</span>
</code></pre></div></div> <p>Here is your parsed questionâ€¦</p> <h4 id="ou"> <code class="language-plaintext highlighter-rouge">iv.ii.i</code> output</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q</span> <span class="o">=</span> <span class="nf">parse_question</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\begin{shortanswer}[fraction=100]{09d21d79} 
![](https://cdn.mathpix.com/cropped/2024_11_04_a374deafc4bc3bc8f639g-10.jpg?height=858&amp;width=861&amp;top_left_y=679&amp;top_left_x=129) 
 
The graph of $y=2 x^{2}+b x+c$ is shown, where $b$ and $c$ are constants. What is the value of $b c$ ? 
\item[fraction=100] -24 
\end{shortanswer}
</code></pre></div></div> <p>Looking good.</p> <h4 id="br"> <code class="language-plaintext highlighter-rouge">iv.ii.ii</code> brief note</h4> <p>Before we proceed, one must note that</p> <p><code class="language-plaintext highlighter-rouge">![](https://cdn.mathpix.com/cropped/2024_11_04_a374deafc4bc3bc8f639g-10.jpg?height=858&amp;width=861&amp;top_left_y=679&amp;top_left_x=129) </code></p> <p>is premature, in the sense that \(\LaTeX\) may only process the media file within this link once it is</p> <ul> <li>downloaded;</li> <li>properly referenced within a directory.</li> </ul> <p>In the <code class="language-plaintext highlighter-rouge">massPix-to-moodle.sty</code> notebook, there is a <code class="language-plaintext highlighter-rouge">media()</code> function that precisely takes care of this matter.</p> <div style="margin-top: 15px;"></div> <p><span style="float:right; font-size: 2em;"> <a href="/projects/mathPix_to_moodle.sty/2/">next: <code class="language-plaintext highlighter-rouge">massPix-to-moodle.sty</code> &gt;</a> </span></p> <div style="margin-top: 60px;"></div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2025 Omar M. Elshenawy. <a href="https://elshenawyom.github.io/impressum-dsvgo/">impressum/dsvgo</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-HHL9LQFS17"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHL9LQFS17");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>