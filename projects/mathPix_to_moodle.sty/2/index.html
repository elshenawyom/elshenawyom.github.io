<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="k_58m2Lddpj9zu2A5OZaMbeMZtgPh7jYnIRxsBdFBwM"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> massPix to moodle.sty | Omar M. Elshenawy </title> <meta name="author" content="Omar M. Elshenawy"> <meta name="description" content="a RegEx project to speed up digital transformation to moodle"> <meta name="keywords" content="junior mathematicianmathematicsmathematics educationmathematical researchtopological graph theoryalgebraic number theorydata analyticsfinanceITproject managementteachingundegraduatenumerical methodsconstructor universityomar elshenawyomar elshinawy"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%CE%BE)&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://elshenawyom.github.io/projects/mathPix_to_moodle.sty/2/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Omar M. Elshenawy </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">curriculum vitae </a> </li> <li class="nav-item "> <a class="nav-link" href="/seminars-talks/">seminars &amp; talks </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">massPix to moodle.sty</h1> <p class="post-description">a RegEx project to speed up digital transformation to moodle</p> </header> <article> <p><span style="float:left; font-size: 1.6em;"> <a href="/projects/mathPix_to_moodle.sty/2/">&lt; back: <code class="language-plaintext highlighter-rouge">mathPix-to-moodle.sty</code></a> </span></p> <p><br></p> <div style="margin-top: 35px;"></div> <hr> <p><strong>Table of Contents</strong></p> <ol type="i"> <li> <a href="#pr">prelim</a> <ol type="i"> <li> <a href="#re"><code>read</code></a> </li> <li> <a href="#no"><code>no_rationale</code></a> </li> <li> <a href="#ans"><code>&lt;ans&gt;</code></a> </li> <li> <a href="#id"><code>&lt;id&gt;</code></a> </li> <li> <a href="#bo"><code>&lt;body&gt;</code></a> </li> <li> <a href="#ty"><code>&lt;type&gt;</code></a> </li> <li> <a href="#sh"><code>shortanswer</code></a> </li> <li> <a href="#mu"><code>multi</code></a> </li> <li> <a href="#pa"><code>parse</code></a> </li> </ol> </li> <li> <a href="#ha">handling</a> </li> <ol type="i"> <li> <a href="#pro">processing</a> </li> <li> <a href="#th">the <code>\section*{ID:</code> string</a> </li> <li> <a href="#ta"><code>tabular</code> environments</a> </li> </ol> <li> <a href="#bp">bad parse</a> </li> <ol type="i"> <li> <a href="#cpi">common parsing issues</a> </li> <li> <a href="#rw">recommended workflow</a> </li> </ol> <li> <a href="#me">media</a> </li> <ol type="i"> <li> <a href="#di">directories</a> </li> <li> <a href="#ap">action plan</a> </li> </ol> <li> <a href="#cl">closing words</a> </li> </ol> <hr> <h1 id="pr">prelim</h1> <p><code class="language-plaintext highlighter-rouge">massPix-to-moodle.sty</code> does what <code class="language-plaintext highlighter-rouge">mathPix-to-moodle.sty</code> does, just in masses. We do not expect the migration to be a smooth process, therefore we set some checks on the consistency of our <code class="language-plaintext highlighter-rouge">.txt</code> input.</p> <p>This will be a re-definition of the previoously referenced functions in <code class="language-plaintext highlighter-rouge">mathPix-to-moodle.sty</code>. Feel free to skip to</p> <p><a href="#ha"><code class="language-plaintext highlighter-rouge">ii.</code> handling</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">nonlin-fn-easy</span><span class="sh">'</span> <span class="c1"># place in txt/ directory!
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div> <h4 id="re"> <code class="language-plaintext highlighter-rouge">i.i</code> - <code class="language-plaintext highlighter-rouge">read</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">content</span>
</code></pre></div></div> <h4 id="no"> <code class="language-plaintext highlighter-rouge">i.ii</code> - <code class="language-plaintext highlighter-rouge">no_rationale</code> </h4> <p>The <code class="language-plaintext highlighter-rouge">no_rationale</code> tool removes the string starting with <code class="language-plaintext highlighter-rouge">\section*{Rationale}</code> inclusive and ending with <code class="language-plaintext highlighter-rouge">\section*{</code> exclusive.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">no_rationale</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># This pattern looks for '\section*{Rationale}' and removes everything until the next '\section*{' or end of string
</span>    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\\section\*\{Rationale\}.*?(?=\\section\*|\Z)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></div> <h4 id="ans"> <code class="language-plaintext highlighter-rouge">i.iii</code> - <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code> </h4> <p>An answer is comprised of either literals <code class="language-plaintext highlighter-rouge">A, B, C, D</code> or combinations of numbers, signs <code class="language-plaintext highlighter-rouge">-</code>, fractions <code class="language-plaintext highlighter-rouge">/</code>, decimals <code class="language-plaintext highlighter-rouge">.</code>, and delimiters <code class="language-plaintext highlighter-rouge">,</code> for <code class="language-plaintext highlighter-rouge">shortanswer</code> questions.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_ans</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Capture everything after 'Correct Answer:' until an invalid character is encountered, including whitespaces
</span>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">Correct\s*Answer:\s*([A-D0-9/.,\s-]+)</span><span class="sh">'</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="bp">None</span>
</code></pre></div></div> <h4 id="id"> <code class="language-plaintext highlighter-rouge">i.iv</code> - <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> </h4> <p>The question <code class="language-plaintext highlighter-rouge">id</code> is fetched by looking up instances of the string</p> <ul> <li><code class="language-plaintext highlighter-rouge">\section*{Question ID</code></li> <li><code class="language-plaintext highlighter-rouge">ID:</code></li> </ul> <p>and assigning <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code> to be the following string.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_id</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Look for the question ID in both formats: section command and plain text
</span>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\\section\*\{Question ID\s+(\w+)\}|ID:\s*(\w+)</span><span class="sh">'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Return the matched ID from either format
</span>    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div> <h4 id="bo"> <code class="language-plaintext highlighter-rouge">i.v</code> - <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> </h4> <p>A question body should between the two strings</p> <ul> <li><code class="language-plaintext highlighter-rouge">\section*{ID: &lt;q-id&gt;}</code></li> <li> <code class="language-plaintext highlighter-rouge">\section*{ID: &lt;q-id&gt; Answer}</code> or <code class="language-plaintext highlighter-rouge">A.</code> </li> </ul> <p>exclusive.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_body</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="c1"># Pattern to capture everything between \section*{ID: &lt;question-id&gt;} or ID: &lt;question-id&gt;
</span>    <span class="c1"># and the start of the choices (A., B., C., D.) or the start of the section for the answer
</span>    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">rf</span><span class="sh">'</span><span class="s">(\\section\*\{</span><span class="si">{</span><span class="n">ID</span><span class="si">:</span> <span class="si">{</span><span class="n">question_id</span><span class="si">}</span>\<span class="si">}</span><span class="s">}|ID: </span><span class="si">{</span><span class="n">question_id</span><span class="si">}</span><span class="s">)\s*(.*?)(?=\s*[A-D]\.\s|\s*\\section\*\{</span><span class="si">{</span><span class="n">ID</span><span class="si">:</span> <span class="si">{</span><span class="n">question_id</span><span class="si">}</span> <span class="n">Answer</span>\<span class="si">}</span><span class="s">}|ID: </span><span class="si">{</span><span class="n">question_id</span><span class="si">}</span><span class="s"> Answer)</span><span class="sh">'</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>  <span class="c1"># Group 2 contains the body content
</span>        <span class="k">if</span> <span class="n">body</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">$</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">body</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">$$</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">^\$(.*?)\$</span><span class="sh">'</span><span class="p">,</span> <span class="sa">r</span><span class="sh">'</span><span class="s">$$\1$$</span><span class="sh">'</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div> <h4 id="ty"> <code class="language-plaintext highlighter-rouge">i.vi</code> - <code class="language-plaintext highlighter-rouge">&lt;type&gt;</code> </h4> <p>The question type is determined by the existence of an isolated <code class="language-plaintext highlighter-rouge">A.</code>, <code class="language-plaintext highlighter-rouge">B.</code>, <code class="language-plaintext highlighter-rouge">C.</code> or <code class="language-plaintext highlighter-rouge">D.</code>. The type is subsequently multiple-choice if one of the literals exist, and short-answer otherwise.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch_qtype</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="c1"># Determine if the question is a short answer or multiple-choice based on the answer format
</span>    <span class="k">if</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\s*\b[a-dA-D]\b\s*</span><span class="sh">'</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>  <span class="c1"># Checks for isolated A, B, C, or D with optional surrounding spaces
</span>        <span class="k">return</span> <span class="sh">"</span><span class="s">multi</span><span class="sh">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">shortanswer</span><span class="sh">"</span>  <span class="c1"># If not, it's immediately a shortanswer
</span></code></pre></div></div> <h4 id="sh"> <code class="language-plaintext highlighter-rouge">i.vii</code> - <code class="language-plaintext highlighter-rouge">shortanswer</code> </h4> <p>The <code class="language-plaintext highlighter-rouge">shortanswer</code> function formats a short-answer-type question as per <code class="language-plaintext highlighter-rouge">moodle.sty</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">shortanswer</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
    <span class="c1"># Split answer on comma to handle multiple answers if present
</span>    <span class="n">answers</span> <span class="o">=</span> <span class="n">answer</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># This will give a list of answers
</span>
    <span class="c1"># Initialize the formatted string for shortanswer
</span>    <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">begin{{shortanswer}}[fraction=100]{{</span><span class="si">{</span><span class="n">question_id</span><span class="si">}</span><span class="s">}}</span><span class="se">\n</span><span class="si">{</span><span class="n">question_body</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span>
    
    <span class="c1"># Add each answer as a separate item with fraction=100
</span>    <span class="k">for</span> <span class="n">ans</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">item[fraction=100] </span><span class="si">{</span><span class="n">ans</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span>
    
    <span class="c1"># Close the shortanswer environment and add \newpage at the end
</span>    <span class="n">formatted</span> <span class="o">+=</span> <span class="sh">"</span><span class="se">\\</span><span class="s">end{shortanswer}</span><span class="se">\n\\</span><span class="s">newpage</span><span class="sh">"</span>
    
    <span class="k">return</span> <span class="n">formatted</span>

</code></pre></div></div> <h4 id="mu"> <code class="language-plaintext highlighter-rouge">i.viii</code> - <code class="language-plaintext highlighter-rouge">multi</code> </h4> <h5 id="ch"><code class="language-plaintext highlighter-rouge">choice</code></h5> <p>The <code class="language-plaintext highlighter-rouge">choice</code> function fetches all the choices in a question.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">choice</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Adjusted pattern to capture choices starting with A., B., C., D., without look-behind
</span>    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">(?:^|\s)([A-D]\.\s)(.*?)(?=(?:\s[A-D]\.\s)|(?:\\section\*\{ID:)|$)</span><span class="sh">'</span>

    <span class="c1"># Find all matches for choices
</span>    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="c1"># Clean up line breaks within each choice text and strip whitespace
</span>        <span class="n">choice_text</span> <span class="o">=</span> <span class="n">match</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
        <span class="n">choices</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">choice_text</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">choices</span> <span class="k">if</span> <span class="n">choices</span> <span class="k">else</span> <span class="bp">None</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">multi</code> finally returns a <code class="language-plaintext highlighter-rouge">moodle.sty</code> formatted multiple-choice question.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multi</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
    <span class="c1"># Map answer to corresponding choice and format multiple-choice question
</span>    <span class="n">answer_index</span> <span class="o">=</span> <span class="nf">ord</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="o">-</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">item * </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="sh">"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">answer_index</span> <span class="k">else</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">item </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">choices</span><span class="p">)]</span>
    <span class="n">formatted_items</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    
    <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="se">\\</span><span class="s">begin{{multi}}{{</span><span class="si">{</span><span class="n">question_id</span><span class="si">}</span><span class="s">}}
</span><span class="si">{</span><span class="n">question_body</span><span class="si">}</span><span class="s">

</span><span class="si">{</span><span class="n">formatted_items</span><span class="si">}</span><span class="s">
</span><span class="se">\\</span><span class="s">end{{multi}}
</span><span class="se">\\</span><span class="s">newpage</span><span class="sh">"""</span>  <span class="c1"># Add \newpage at the end
</span>    
    <span class="k">return</span> <span class="n">formatted</span>
</code></pre></div></div> <h4 id="pa"> <code class="language-plaintext highlighter-rouge">i.ix</code> - <code class="language-plaintext highlighter-rouge">parse</code> </h4> <p>Main function to orchestrate parsing and formatting…</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nf">no_rationale</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">question_id</span> <span class="o">=</span> <span class="nf">fetch_id</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="nf">fetch_ans</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">question_body</span> <span class="o">=</span> <span class="nf">fetch_body</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">question_id</span><span class="p">)</span>
    
    <span class="c1"># Check which part is missing and provide detailed feedback
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">question_id</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">question_id</span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">question_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unable to parse question ID.</span><span class="sh">"</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">question_body</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unable to parse question body.</span><span class="sh">"</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">answer</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unable to parse answer.</span><span class="sh">"</span>

    <span class="n">question_type</span> <span class="o">=</span> <span class="nf">fetch_qtype</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">question_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">shortanswer</span><span class="sh">"</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">shortanswer</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">question_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">multi</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nf">choice</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">choices</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">multi</span><span class="p">(</span><span class="n">question_id</span><span class="p">,</span> <span class="n">question_body</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">choices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Multiple-choice question lacks choices or has an incorrect format.</span><span class="sh">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Error: Unknown question type or unrecognized answer format.</span><span class="sh">"</span>
</code></pre></div></div> <h1 id="ha"> <code class="language-plaintext highlighter-rouge">ii.</code> handling</h1> <p><code class="language-plaintext highlighter-rouge">mathPIX</code> is a great tool, but is prone to error. Here, we start to make quality checks on the parsed questions.</p> <h3 id="pro"> <code class="language-plaintext highlighter-rouge">ii.i</code> processing</h3> <p>Start by reading the contents of the converted mathPix <code class="language-plaintext highlighter-rouge">.txt</code> file. Always check that your <code class="language-plaintext highlighter-rouge">.txt</code> file is in the <code class="language-plaintext highlighter-rouge">txt/</code> directory; or more generally, in a directory that could be read.</p> <p><em>N.B: The variable <code class="language-plaintext highlighter-rouge">txt</code> is defined in the first block.</em></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">txt/</span><span class="sh">"</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.txt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">latin-1</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>   
</code></pre></div></div> <p>We start by separating questions.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">q_split</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Split the text by lines and initialize a list for questions
</span>    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">()</span>
    <span class="n">questions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_question</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Insert a marker line to handle the first question correctly
</span>    <span class="n">lines</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">START</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Regular expression to detect "\section*{Question ID" with possible line breaks or spaces
</span>    <span class="n">question_start_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\\section\*\{\s*Question\s+ID</span><span class="sh">'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="c1"># Check if the line matches the start of a question with flexible spacing/newlines
</span>        <span class="k">if</span> <span class="n">question_start_pattern</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># If current_question has content, save it as a complete question
</span>            <span class="k">if</span> <span class="n">current_question</span><span class="p">:</span>
                <span class="n">questions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">current_question</span><span class="p">).</span><span class="nf">strip</span><span class="p">())</span>
                <span class="n">current_question</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Reset for the next question
</span>        <span class="c1"># Add line to the current question content
</span>        <span class="n">current_question</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Add any remaining question content after the loop finishes
</span>    <span class="k">if</span> <span class="n">current_question</span><span class="p">:</span>
        <span class="n">questions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">current_question</span><span class="p">).</span><span class="nf">strip</span><span class="p">())</span>

    <span class="c1"># Return all questions except the first marker
</span>    <span class="k">return</span> <span class="n">questions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Skip the initial marker question
</span></code></pre></div></div> <p>One may hope for <code class="language-plaintext highlighter-rouge">n</code> to be the actual number of questions in the document.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">question</span> <span class="o">=</span> <span class="nf">q_split</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>25
</code></pre></div></div> <p>If result is not equal to the number questions, then the string <code class="language-plaintext highlighter-rouge">Question ID</code> must be carefully checked, since two (or more) questions are counted as one.</p> <h3 id="th"> <code class="language-plaintext highlighter-rouge">ii.ii</code> the <code class="language-plaintext highlighter-rouge">\section*{ID: </code> string</h3> <p>Earlier, we discussed how the question <code class="language-plaintext highlighter-rouge">id</code> is read using the following setup,</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\section*{ID: &lt;id&gt;}

&lt;body&gt;
&lt;choices&gt; %if any

\section*{ID: &lt;id&gt; Answer}

</code></pre></div></div> <p>This is not immediately always the case. With <code class="language-plaintext highlighter-rouge">mathPIX,</code> there are instances where we get</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ID: &lt;id&gt;

&lt;body&gt;
&lt;choices&gt; %if any

\section*{ID: &lt;id&gt; Answer}

</code></pre></div></div> <p>without the <code class="language-plaintext highlighter-rouge">\section*{</code> string.</p> <p>The <code class="language-plaintext highlighter-rouge">choice</code> function responsible for fetching choices works by scanning initials A-D from <code class="language-plaintext highlighter-rouge">\section*{</code> to <code class="language-plaintext highlighter-rouge">\section*{</code>. Therefore, we would like to manually add this string to standalone <code class="language-plaintext highlighter-rouge">ID: &lt;id&gt;</code> instances for the sake of consistency.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">section_string</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Look for standalone "ID:" not already in \section*{...}
</span>    <span class="c1"># Using a negative lookbehind to ensure it’s not preceded by "\section*{"
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">(?&lt;!\\section\*\{)ID:</span><span class="sh">'</span><span class="p">,</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\\section*{ID:</span><span class="sh">'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">s</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">section_string</span><span class="p">(</span><span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div> <h3 id="ta"> <code class="language-plaintext highlighter-rouge">ii.iii</code> - <code class="language-plaintext highlighter-rouge">tabular</code> environments</h3> <p>We are then faced with two tabular problems,</p> <ul> <li> <code class="language-plaintext highlighter-rouge">moodle.sty</code> cannot handle tables properly. Therefore we need to embed them as pictures when compiling the \(\LaTeX\) file.</li> <li> <code class="language-plaintext highlighter-rouge">mathPix</code> includes tables on top which are unnecessary.</li> </ul> <p>This is easy to handle. We use <code class="language-plaintext highlighter-rouge">tabular_handling</code> to</p> <ul> <li>get rid of the annoying tables that indicate the difficulty, skill and assessment, as in</li> </ul> <div style="text-align: center;"> <img src="/assets/img/mathPIX-to-moodle.sty/download.png" class="img-fluid rounded z-depth-1" style="width: 70%; height: auto;"> </div> <div style="margin-top: 15px;"></div> <ul> <li>use <code class="language-plaintext highlighter-rouge">\embedaspict{}</code> for tabular items, which embeds the contents of its two braces as a picture upon compilation.</li> </ul> <p>This is effectively done by deleting tables with the string <code class="language-plaintext highlighter-rouge">Assessment &amp; Test &amp; Domain &amp; Skill &amp; Difficulty</code>, and wrapping with <code class="language-plaintext highlighter-rouge">\embedaspict{}</code> otherwise.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">tabular_handling</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># Define the regex pattern to match the entire tabular environment
</span>    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\\begin\{tabular\}.*?\\end\{tabular\}</span><span class="sh">'</span>

    <span class="c1"># Use re.findall to get all instances of tabular environments
</span>    <span class="n">tabular_instances</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="c1"># Check each instance and remove it if it contains the specified string
</span>    <span class="k">for</span> <span class="n">tabular</span> <span class="ow">in</span> <span class="n">tabular_instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">Assessment &amp; Test &amp; Domain &amp; Skill &amp; Difficulty</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">tabular</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tabular</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Wrap tabular in \begin{center} \end{center} and \embedaspict{...}
</span>            <span class="n">wrapped_tabular</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">begin{{center}}</span><span class="se">\n\\</span><span class="s">embedaspict{{</span><span class="se">\n</span><span class="si">{</span><span class="n">tabular</span><span class="si">}</span><span class="se">\n</span><span class="s">}}</span><span class="se">\\</span><span class="s">end{{center}}</span><span class="sh">"</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tabular</span><span class="p">,</span> <span class="n">wrapped_tabular</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="nf">tabular_handling</span><span class="p">(</span><span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div> <p><strong>Disclaimer.</strong> This code snippet behaves badly with nested <code class="language-plaintext highlighter-rouge">\tabular</code> environments. Especially a problem, as <code class="language-plaintext highlighter-rouge">mathPIX</code> inherently writes nested <code class="language-plaintext highlighter-rouge">\tabular</code> environments.</p> <h1 id="bp"> <code class="language-plaintext highlighter-rouge">iii.</code> bad parse</h1> <p>We classify inaccuracies into</p> <ol> <li> <strong>coding</strong>, which arise from uncareful handling</li> </ol> <p>We pass on our questions for parsing and see which ones are <em>bad</em>. Our <code class="language-plaintext highlighter-rouge">parse</code> function is the same one we built for single-questions, and is well-designed to trace errors.</p> <ol> <li> <strong>logic</strong>, which cannot be indicated through code.</li> </ol> <p>There is little we can do to automate the process - one must carefully review the final output.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">bad_parse</span><span class="p">(</span><span class="n">questions</span><span class="p">):</span>
    <span class="n">bad_index</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># parse every question
</span>        <span class="n">result</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">questions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  
        <span class="c1"># if error 
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">Error:</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>  
            <span class="c1"># append the bad index i
</span>            <span class="n">bad_index</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">bad_index</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bad_questions</span> <span class="o">=</span> <span class="nf">bad_parse</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">bad_questions</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[]
</code></pre></div></div> <h3 id="cpi"> <code class="language-plaintext highlighter-rouge">iii.i</code> common parsing issues</h3> <p>With a list of <em>bad</em> questions, we inspect on our way to a more complicated construction. Here are all troubleshooting cases I faced.</p> <ol> <li><strong><code class="language-plaintext highlighter-rouge">Correct Answer: &lt;ans&gt;</code> segment of the question is not supplied.</strong></li> </ol> <p>This happens sometimes with questions. The fix is to have the <code class="language-plaintext highlighter-rouge">pdf</code> document to manually supply <code class="language-plaintext highlighter-rouge">&lt;ans&gt;</code>.</p> <ol> <li><strong><code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> cannot be supplied.</strong></li> </ol> <p>In this case, you need to manually include <code class="language-plaintext highlighter-rouge">\section*{ID: &lt;id&gt;}</code> and <code class="language-plaintext highlighter-rouge">\section*{ID: &lt;id&gt; Answer}</code> yourself around the question body.</p> <ol> <li><strong><code class="language-plaintext highlighter-rouge">&lt;choice&gt;</code> cannot be supplied.</strong></li> </ol> <p>This occurs as a result of a mis-identified literal, e.g a sentence that ends with a variable <code class="language-plaintext highlighter-rouge">c.</code>. It conflicts with The solution in that case is to wrap <code class="language-plaintext highlighter-rouge">$c.$</code> in <code class="language-plaintext highlighter-rouge">math</code> to avoid <code class="language-plaintext highlighter-rouge">regex</code> detection.</p> <ol> <li><strong>Bad <code class="language-plaintext highlighter-rouge">&lt;char&gt;</code> in text.</strong></li> </ol> <p>If there is a bad character that e.g. prevents <code class="language-plaintext highlighter-rouge">fetch_body</code> from detecting a character <code class="language-plaintext highlighter-rouge">A</code>, a simple fix is to backspace the suspected area and rewrite the character.</p> <ol> <li><strong>MathPix renders <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> in LaTeX.</strong></li> </ol> <p>This means, <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> = <code class="language-plaintext highlighter-rouge">$</code>$c_1 c_2 c_3\quad$ $c_4c_5\quad$ $c_6c_7c_8$ <code class="language-plaintext highlighter-rouge">$</code>. The issue is simply fixed by removing <code class="language-plaintext highlighter-rouge">$$</code> and glueing <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> back in place.</p> <ol> <li> <strong><code class="language-plaintext highlighter-rouge">Question ID &lt;id&gt;</code>$\neq$<code class="language-plaintext highlighter-rouge">ID:&lt;id&gt;</code></strong>.</li> </ol> <p>Rare, happens with instances as Cc or 0Oo.</p> <h4 id="rw"> <code class="language-plaintext highlighter-rouge">iii.ii</code> recommended workflow</h4> <ul> <li>Keep your <code class="language-plaintext highlighter-rouge">.txt</code>, <code class="language-plaintext highlighter-rouge">.pdf</code> files on standby.</li> <li>Fetch question <code class="language-plaintext highlighter-rouge">id</code> using <code class="language-plaintext highlighter-rouge">q_id</code>.</li> <li>Detect which component cannot be fetched (<code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">ans</code>, <code class="language-plaintext highlighter-rouge">choice</code>, …).</li> <li>Look up <code class="language-plaintext highlighter-rouge">id</code> in your <code class="language-plaintext highlighter-rouge">.txt</code> file.</li> <li>Fix the problem using one of the common troubleshooting cases.</li> </ul> <p>upon appropriate changes to the <code class="language-plaintext highlighter-rouge">.txt</code> file, you should restart the notebook and observe the behaviour.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q</span> <span class="o">=</span> <span class="n">question</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#debug here by question, default = 0 
</span>
<span class="n">q_type</span> <span class="o">=</span> <span class="nf">fetch_qtype</span><span class="p">(</span><span class="n">q</span><span class="p">);</span> 
<span class="n">q_id</span> <span class="o">=</span> <span class="nf">fetch_id</span><span class="p">(</span><span class="n">q</span><span class="p">);</span> 
<span class="n">q_parse</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>  
<span class="n">q_ans</span> <span class="o">=</span> <span class="nf">fetch_ans</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">q_choices</span> <span class="o">=</span> <span class="nf">choice</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">q_body</span> <span class="o">=</span> <span class="nf">fetch_body</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q_id</span><span class="p">)</span>

<span class="c1"># multi only
</span><span class="n">q_format</span> <span class="o">=</span> <span class="nf">multi</span><span class="p">(</span><span class="n">q_id</span><span class="p">,</span> <span class="n">q_body</span><span class="p">,</span> <span class="n">q_ans</span><span class="p">,</span> <span class="n">q_choices</span><span class="p">)</span>


<span class="c1">### COMMENT OUT WHAT YOU DON'T NEED
</span>
<span class="nf">print</span><span class="p">(</span>
      <span class="sh">"</span><span class="s">id: </span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">q_id</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span> 
      <span class="sh">"</span><span class="s">type: </span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">q_type</span><span class="p">)</span><span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span>
      <span class="sh">"</span><span class="s">ans: </span><span class="sh">"</span><span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">q_ans</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span>
      <span class="sh">"</span><span class="s">choices: </span><span class="sh">"</span><span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">q_choices</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="s">---</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span>
      <span class="sh">"</span><span class="s">body: </span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span><span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">q_body</span><span class="p">)</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="s">---</span><span class="se">\n</span><span class="sh">"</span> <span class="o">+</span>    
      <span class="sh">"</span><span class="s">parse result:</span><span class="sh">"</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span> <span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">q_parse</span><span class="p">)</span><span class="o">+</span> <span class="sh">"</span><span class="se">\n</span><span class="s">===</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id: 6abec9a8
type: multi
ans: B
choices: ['$(-1,-9)$', '$(0,-5)$', '$(0,-4)$', '$(0,0)$']
---
body: 

![](https://cdn.mathpix.com/cropped/2024_11_04_03d5d09e2296f53345b9g-01.jpg?height=857&amp;width=866&amp;top_left_y=671&amp;top_left_x=121)

What is the $y$-intercept of the graph shown?
---
parse result:

\begin{multi}{6abec9a8}
![](https://cdn.mathpix.com/cropped/2024_11_04_03d5d09e2296f53345b9g-01.jpg?height=857&amp;width=866&amp;top_left_y=671&amp;top_left_x=121)

What is the $y$-intercept of the graph shown?

\item $(-1,-9)$
\item * $(0,-5)$
\item $(0,-4)$
\item $(0,0)$
\end{multi}
\newpage
===
</code></pre></div></div> <h1 id="me"> <code class="language-plaintext highlighter-rouge">iv.</code> media</h1> <p>By now we should be fairly ready to start parsing into \(\LaTeX.\)</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">shutil</span>
</code></pre></div></div> <h4 id="di"> <code class="language-plaintext highlighter-rouge">iv.i</code> directories</h4> <p>The first thing we would do now is create a directory with our <code class="language-plaintext highlighter-rouge">.tex</code> file. This is necessary due to the way that \(\LaTeX\) handles file referencing. We would like to also overwrite any existing directory upon re-run.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">directory</span> <span class="o">=</span> <span class="sh">"</span><span class="s">TeX</span><span class="sh">"</span><span class="o">+</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">+</span><span class="n">filename</span>

<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="n">shutil</span><span class="p">.</span><span class="nf">rmtree</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s"> directory and its contents have been deleted.</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s"> directory does not exist. Creating...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> 

<span class="c1"># Full path to the .tex file inside the "TeX" folder
</span><span class="n">tex_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.tex</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TeX-nonlin-fn-easy directory and its contents have been deleted.
</code></pre></div></div> <p>The next command creates a directory of assets.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span><span class="sh">"</span><span class="s">/assets</span><span class="sh">"</span>

<span class="c1"># Create the nested directories if they don't already exist
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</code></pre></div></div> <h4 id="ap"> <code class="language-plaintext highlighter-rouge">iv.ii</code> action plan</h4> <p>We would like to</p> <ul> <li>detect all hyperlinks to media files</li> <li>download the media files to <code class="language-plaintext highlighter-rouge">assets</code> </li> <li>name each media file according to the hyperlink’s <code class="language-plaintext highlighter-rouge">&lt;img-name&gt;.jpg</code> </li> <li>extract height &amp; width for proper scaling</li> <li>replace the URL with <code class="language-plaintext highlighter-rouge">\includegraphics[width=&lt;width&gt;, height=&lt;height&gt;]{&lt;image_path&gt;}</code> </li> </ul> <p>using one function! A lot, right?</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">media</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">):</span>
    <span class="c1"># Ensure 'question' is a string. If it's a list, process each item in the list.
</span>    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="nf">media</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">question</span><span class="p">]</span>  <span class="c1"># Recursively apply the function to each item
</span>    
    <span class="c1"># Find the image URL in the question
</span>    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">(https://cdn\.mathpix\.com/[^\s]+?\.jpg(\?[^)]*)?)</span><span class="sh">"</span><span class="p">,</span> <span class="n">question</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">question</span>  <span class="c1"># Start with the original question text
</span>    
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Extract the filename from the URL (without the date part and without underscores)
</span>        <span class="n">filename</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># e.g., "2024_11_04_a374deafc4bc3bc8f639g-10.jpg"
</span>
        <span class="c1"># Remove the date part (everything before the first underscore)
</span>        <span class="n">filename</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">^\d{4}_\d{2}_\d{2}_</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  <span class="c1"># Remove "2024_11_04_"
</span>        
        <span class="c1"># Remove underscores for LaTeX
</span>        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>
        
        <span class="c1"># Use the directory as is (no replacement of backslashes here)
</span>        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span>
        
        <span class="c1"># Escape underscores in the directory part
</span>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">,</span> <span class="sa">r</span><span class="sh">"</span><span class="s">\_</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Combine the path and filename
</span>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Create the directory if it does not exist
</span>        <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Extract dimensions from the URL query parameters if they exist
</span>        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">?</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">(\w+)=([\d]+)</span><span class="sh">"</span><span class="p">,</span> <span class="n">query_params</span><span class="p">))</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">height</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">height</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">}</span>
        
        <span class="c1"># Download and save the image
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>
            
            <span class="c1"># Save the image to the correct directory
</span>            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">img_file</span><span class="p">:</span>
                <span class="n">img_file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Downloaded and saved: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="c1"># Prepare LaTeX includegraphics line
</span>            <span class="k">if</span> <span class="n">dimensions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">height</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dimensions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">width</span><span class="sh">"</span><span class="p">):</span>
                <span class="c1"># Divide width and height by f
</span>                <span class="n">f</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">dimensions</span><span class="p">[</span><span class="sh">'</span><span class="s">width</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">dimensions</span><span class="p">[</span><span class="sh">'</span><span class="s">height</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">f</span>

                <span class="c1"># Replace backslashes and clean up the path format
</span>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Use forward slashes in LaTeX path
</span>                <span class="c1">#file_path = file_path.split('assets/', 1)[-1]
</span>                <span class="c1">#file_path = 'assets/' + file_path
</span>                <span class="n">latex_command</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\\</span><span class="s">includegraphics[width=</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s">px, height=</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s">px]{{</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s">}}</span><span class="sh">"</span>
                
                <span class="c1"># Replace the URL in the question with LaTeX command
</span>                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">![](</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">,</span> <span class="n">latex_command</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to download </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">media</code> function leaves media-free questions unaffected.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">media</span><span class="p">(</span><span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-01.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-04.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-04.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-04.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-04.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-08.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-10.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-11.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-14.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-16.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-18.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-19.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-19.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-19.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-19.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-22.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-26.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-27.jpg
Downloaded and saved: TeX-nonlin-fn-easy/assets\03d5d09e2296f53345b9g-28.jpg
</code></pre></div></div> <h1 id="cl"> <code class="language-plaintext highlighter-rouge">v.</code> closing words</h1> <p>Let us collect all parsed questions in one string, separated by two lines.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">latex</span> <span class="o">=</span> <span class="sh">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">question</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">latex</span> <span class="o">+=</span> <span class="n">temp</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">tex_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">latex</span><span class="p">)</span>
</code></pre></div></div> <p>Now that the questions are ready, one only needs to compile into <code class="language-plaintext highlighter-rouge">moodle.sty</code>. Even with a considerable human element of reviewing the <code class="language-plaintext highlighter-rouge">.txt</code> file for consistency, the solution has spared me much more time than I had originally invested.</p> <p>Instead of dealing with 1000 questions, I only had to deal with 70-80 badly parsed questions. Even then, I did not have to start from scratch, but implement simple edits to the <code class="language-plaintext highlighter-rouge">.txt</code> file.</p> <p>\(\LaTeX\), <code class="language-plaintext highlighter-rouge">RegEx</code>, <code class="language-plaintext highlighter-rouge">moodle</code>, <code class="language-plaintext highlighter-rouge">mathPIX</code>, and <code class="language-plaintext highlighter-rouge">SAT</code>. Who would have thought? \(\boxed \xi\)</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Omar M. Elshenawy. <a href="https://elshenawyom.github.io/impressum-dsvgo/">impressum/dsvgo</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-HHL9LQFS17"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-HHL9LQFS17");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>